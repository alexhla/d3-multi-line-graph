<!DOCTYPE html>
<html lang="en">
<head>
    <title> D3.js | Demo</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="bootstrap.min.css">
    <link rel="stylesheet" href="font-awesome-4.7.0/css/font-awesome.min.css">
 
    <link rel="stylesheet" href="nouislider.min.css">
    <link rel="stylesheet" href="bootstrap-toggle.min.css"> 
    <link rel="stylesheet" href="demo.css">
</head>

<hr>

<div class="centerText">

		<div id="sliderTimeSelectDisplay">
				<span id="userFeedbackSpan" class="topBannerSubtitle">Data From&nbsp;</span>
				<span class="example-val bodyText" id="lowerDB"></span>
				<span class="topBannerSubtitle">&nbsp;To&nbsp;</span>
				<span class="example-val bodyText" id="upperDB"></span>
				<span class="topBannerSubtitle">&nbsp;At&nbsp;</span>
				<select id="timeIntervalMenu" class="btn btn-success dropdown-toggle" autocomplete="off">
						<option value="1">1</option>
						<option value="5">5</option>
						<option value="15" selected="selected">15</option>
						<option value="30">30</option>
						<option value="60">60</option>
						<option value="180">180</option>
						<option value="360">360</option>
				</select>
				<span class="topBannerSubtitle">&nbsp;Minute Intervals</span>

				<br><br>
				<div id="sliderDB" style="width:95%;margin:auto;"></div>
		</div>

		<br>
		<!-- Sensor Checkbox Selections -->
		<div class="container" style="font-family:Droid Sans Mono;">
			<form>
				<label class="checkbox-inline">
					<input id="ambTempCB" type="checkbox" onchange="rebuildDemo()" checked="checked">
					Ambient Temperature
				</label>
				<label class="checkbox-inline">
					<input id="rhCB" type="checkbox" onchange="rebuildDemo()" checked="checked">
					Relative Humidity
				</label>
				<label class="checkbox-inline">
					<input id="parCB" type="checkbox" onchange="rebuildDemo()">
					PAR
				</label>
				<label class="checkbox-inline">
					<input id="luxCB" type="checkbox" onchange="rebuildDemo()">
					Illuminance
				</label>
				<label class="checkbox-inline">
					<input id="infraredCB" type="checkbox" onchange="rebuildDemo()">
					Infrared
				</label>
				<label class="checkbox-inline">
					<input id="uvaCB" type="checkbox" onchange="rebuildDemo()">
					UVA
				</label>
				<label class="checkbox-inline">
					<input id="uvbCB" type="checkbox" onchange="rebuildDemo()" checked="checked">
					UVB
				</label>
				<label class="checkbox-inline">
					<input id="m1CB" type="checkbox" onchange="rebuildDemo()" checked="checked">
					Moisture #1
				</label>
				<label class="checkbox-inline">
					<input id="m2CB" type="checkbox" onchange="rebuildDemo()" checked="checked">
					Moisture #2
				</label>
				<label class="checkbox-inline">
					<input id="rzt1CB" type="checkbox" onchange="rebuildDemo()" checked="checked">
					Root Zone Temperature #1
				</label>
				<label class="checkbox-inline">
					<input id="rzt2CB" type="checkbox" onchange="rebuildDemo()">
					Root Zone Temperature #2
				</label>
				<label class="checkbox-inline">
					<input id="co2CB" type="checkbox" onchange="rebuildDemo()" checked="checked">
					CO2
				</label>
				<label class="checkbox-inline">
					<input id="phCB" type="checkbox" onchange="rebuildDemo()" checked="checked">
					pH
				</label>
				<label class="checkbox-inline">
					<input id="ecCB" type="checkbox" onchange="rebuildDemo()" checked="checked">
					EC
				</label>
				<label class="checkbox-inline">
					<input id="h2oTempCB" type="checkbox" onchange="rebuildDemo()" checked="checked">
					Water Temperature
				</label>
				<label class="checkbox-inline">
					<input id="h2oLevelCB" type="checkbox" onchange="rebuildDemo()" checked="checked">
					Water Level
				</label>
			</form>
		</div>

		<br>

		<button title="Y-Axis Assignments" class="btn btn-success" onclick="yAxisToggleShowHide();"><i class="fa fa-exchange fa-lg"></i></button>
		&nbsp;&nbsp;		
		<button title="Graph Settings" class="btn btn-success" onclick="graphSettingShowHide();"><i class="fa fa-cog fa-lg"></i></button>
		&nbsp;&nbsp;


<!-- Demo Does Not Support Notifications and Excel Export -->

<!-- 		<a href='/sensors/notifications' title="Go To Notifications" role="button" class="btn btn-success"><i class="fa fa-bell-o fa-lg"></i></a>
		<button class ="btn btn-success" title="Export to Excel" onclick="requestExcelExport()"><i id="excelExportIcon" class="fa fa-file-excel-o fa-lg"></i></button>

		<div id="downloadExcelFileButton" style="display:none;">                
			<form id ="pathToExcelDownload" method="post" action="">
				<button class = "btn btn-success">
						<i class="fa fa-cloud-download fa-lg"></i>
				</button>
			</form>
		</div> 
-->


		<br>
		<br>

		<div id="yAxisToggleDisplay" class="container" style="font-family:Droid Sans Mono;" hidden>

			<span class="bodyText">Y-Axis Assignments</span>
			<br>
			<br>
			<span style="display: inline-block;">
				Ambient Temperature&nbsp;&nbsp;
				<input type="checkbox" id="ambTempYAxisToggle" data-toggle="toggle" data-onstyle="success" data-offstyle="secondary" data-on="Left" data-off="Right" data-width="70"onchange = "eraseAndRedrawGraph()" checked="checked">
				&nbsp;&nbsp;&nbsp;&nbsp;
			</span>
			<span style="display: inline-block;">
				Relative Humidity&nbsp;&nbsp;
				<input type="checkbox" id="rhYAxisToggle" data-toggle="toggle" data-onstyle="success" data-offstyle="secondary" data-on="Left" data-off="Right" data-width="70"
				onchange = "eraseAndRedrawGraph()" checked="checked">
				&nbsp;&nbsp;&nbsp;&nbsp;
			</span>
			<span style="display: inline-block;">
				PAR&nbsp;&nbsp;
				<input type="checkbox" id="parYAxisToggle" data-toggle="toggle" data-onstyle="success" data-offstyle="secondary" data-on="Left" data-off="Right" data-width="70"
				onchange = "eraseAndRedrawGraph()">
				&nbsp;&nbsp;&nbsp;&nbsp;
			</span>
			<span style="display: inline-block;">
				Illuminance&nbsp;&nbsp;
				<input type="checkbox" id="luxYAxisToggle" data-toggle="toggle" data-onstyle="success" data-offstyle="secondary" data-on="Left" data-off="Right" data-width="70"
				onchange = "eraseAndRedrawGraph()" checked="checked">
				&nbsp;&nbsp;&nbsp;&nbsp;
			</span>
			<span style="display: inline-block;">
				Infrared&nbsp;&nbsp;
				<input type="checkbox" id="infraredYAxisToggle" data-toggle="toggle" data-onstyle="success" data-offstyle="secondary" data-on="Left" data-off="Right" data-width="70"
				onchange = "eraseAndRedrawGraph()">
				&nbsp;&nbsp;&nbsp;&nbsp;
			</span>
			<span style="display: inline-block;">
				UVA&nbsp;&nbsp;
				<input type="checkbox" id="uvaYAxisToggle" data-toggle="toggle" data-onstyle="success" data-offstyle="secondary" data-on="Left" data-off="Right" data-width="70"
				 onchange = "eraseAndRedrawGraph()">
				&nbsp;&nbsp;&nbsp;&nbsp;
			</span>
			<span style="display: inline-block;">
				UVB&nbsp;&nbsp;
				<input type="checkbox" id="uvbYAxisToggle" data-toggle="toggle" data-onstyle="success" data-offstyle="secondary" data-on="Left" data-off="Right" data-width="70"
				onchange = "eraseAndRedrawGraph()">
				&nbsp;&nbsp;&nbsp;&nbsp;
			</span>
			<span style="display: inline-block;" checked="checked">
				Moisture #1&nbsp;&nbsp;
				<input type="checkbox" id="m1YAxisToggle" data-toggle="toggle" data-onstyle="success" data-offstyle="secondary" data-on="Left" data-off="Right" data-width="70"
				onchange = "eraseAndRedrawGraph()" checked="checked">
				&nbsp;&nbsp;&nbsp;&nbsp;
			</span>
			<span style="display: inline-block;">
				Moisture #2&nbsp;&nbsp;
				<input type="checkbox" id="m2YAxisToggle" data-toggle="toggle" data-onstyle="success" data-offstyle="secondary" data-on="Left" data-off="Right" data-width="70"
				onchange = "eraseAndRedrawGraph()" checked="checked">
				&nbsp;&nbsp;&nbsp;&nbsp;
			</span>
			<span style="display: inline-block;">	
				Root Zone Temperature #1&nbsp;&nbsp;
				<input type="checkbox" id="rzt1YAxisToggle" data-toggle="toggle" data-onstyle="success" data-offstyle="secondary" data-on="Left" data-off="Right" data-width="70"
				onchange = "eraseAndRedrawGraph()" checked="checked">
				&nbsp;&nbsp;&nbsp;&nbsp;
			</span>
			<span style="display: inline-block;">	
				Root Zone Temperature #2&nbsp;&nbsp;
				<input type="checkbox" id="rzt2YAxisToggle" data-toggle="toggle" data-onstyle="success" data-offstyle="secondary" data-on="Left" data-off="Right" data-width="70"
				onchange = "eraseAndRedrawGraph()" checked="checked">
				&nbsp;&nbsp;&nbsp;&nbsp;
			</span>
			<span style="display: inline-block;">	
				CO2&nbsp;&nbsp;
				<input type="checkbox" id="co2YAxisToggle" data-toggle="toggle" data-onstyle="success" data-offstyle="secondary" data-on="Left" data-off="Right" data-width="70"
				onchange = "eraseAndRedrawGraph()">
				&nbsp;&nbsp;&nbsp;&nbsp;
			</span>
			<span style="display: inline-block;">	
				PH&nbsp;&nbsp;
				<input type="checkbox" id="phYAxisToggle" data-toggle="toggle" data-onstyle="success" data-offstyle="secondary" data-on="Left" data-off="Right" data-width="70"
				onchange = "eraseAndRedrawGraph()" checked="checked">
				&nbsp;&nbsp;&nbsp;&nbsp;
			</span>
			<span style="display: inline-block;">	
				EC&nbsp;&nbsp;
				<input type="checkbox" id="ecYAxisToggle" data-toggle="toggle" data-onstyle="success" data-offstyle="secondary" data-on="Left" data-off="Right" data-width="70"
				onchange = "eraseAndRedrawGraph()">
				&nbsp;&nbsp;&nbsp;&nbsp;
			</span>
			<span style="display: inline-block;">	
				Water Temperature&nbsp;&nbsp;
				<input type="checkbox" id="h2oTempYAxisToggle" data-toggle="toggle" data-onstyle="success" data-offstyle="secondary" data-on="Left" data-off="Right" data-width="70"
				onchange = "eraseAndRedrawGraph()" checked="checked">
				&nbsp;&nbsp;&nbsp;&nbsp;
			</span>
			<span style="display: inline-block;">	
				Reservoir Level&nbsp;&nbsp;
				<input type="checkbox" id="h2oLevelYAxisToggle" data-toggle="toggle" data-onstyle="success" data-offstyle="secondary" data-on="Left" data-off="Right" data-width="70"
				onchange = "eraseAndRedrawGraph()" checked="checked">
			</span>	
			<br>
			<br>
 		</div>


		<div id="graphSettingDisplay" class="container" style="font-family:Droid Sans Mono;" hidden>
				<span class="bodyText">Graph Settings</span>
				<br>
				<br>
				Canvas Size&nbsp;
				<button class ="btn btn-success" onclick="plus()"><i class="fa fa-plus-square fa-lg"></i></button>
				<button class ="btn btn-success" onclick="minus()"><i class="fa fa-minus-square fa-lg"></i></button>
				<br>
				Fill Color&nbsp;
				<select id="fillColorMenu" class="btn btn-success dropdown-toggle" autocomplete="off" onchange = "eraseAndRedrawGraph()">
					<option value="white" selected="selected">white</option>
					<option value="black">black</option>
				</select>

				<br>
				Stroke Thickness&nbsp;
				<select id="strokeThicknessMenu" class="btn btn-success dropdown-toggle" autocomplete="off" onchange = "eraseAndRedrawGraph()">
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3" selected="selected">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
					<option value="6">6</option>
				</select>

				<br>
				<label class="checkbox-inline"><input id="gridEnableCheckBox" type="checkbox" onchange = "eraseAndRedrawGraph()">Grid Enable</label>

				<br>
				<label class="checkbox-inline"><input id="cursorEnableCheckBox" type="checkbox" onchange = "eraseAndRedrawGraph()" checked="checked">Cursor Enable</label>

				<br>
				<select id="XTickCountMenu" class="btn btn-success dropdown-toggle" autocomplete="off" onchange = "eraseAndRedrawGraph()">
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5</option>
						<option value="6">6</option>
						<option value="7">7</option>
						<option value="8">8</option>
						<option value="9">9</option>
						<option value="10" selected="selected">10</option>
						<option value="11">11</option>
						<option value="12">12</option>
						<option value="13">13</option>
						<option value="14">14</option>
						<option value="15">15</option>
						<option value="16">16</option>
						<option value="17">17</option>
						<option value="18">18</option>
						<option value="19">19</option>
						<option value="20">20</option>
						<option value="21">21</option>
						<option value="22">22</option>
						<option value="23">23</option>
						<option value="24">24</option>
						<option value="25">25</option>
						<option value="26">26</option>
						<option value="27">27</option>
						<option value="28">28</option>
						<option value="29">29</option>
						<option value="30">30</option>
				</select>
				&nbsp;X-Axis Ticks

				<br>
				<select id="YTickCountMenu" class="btn btn-success dropdown-toggle" autocomplete="off" onchange = "eraseAndRedrawGraph()">
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5</option>
						<option value="6">6</option>
						<option value="7">7</option>
						<option value="8">8</option>
						<option value="9">9</option>
						<option value="10" selected="selected">10</option>
						<option value="11">11</option>
						<option value="12">12</option>
						<option value="13">13</option>
						<option value="14">14</option>
						<option value="15">15</option>
						<option value="16">16</option>
						<option value="17">17</option>
						<option value="18">18</option>
						<option value="19">19</option>
						<option value="20">20</option>
						<option value="21">21</option>
						<option value="22">22</option>
						<option value="23">23</option>
						<option value="24">24</option>
						<option value="25">25</option>
						<option value="26">26</option>
						<option value="27">27</option>
						<option value="28">28</option>
						<option value="29">29</option>
						<option value="30">30</option>
				</select>
				&nbsp;Y-Axis Ticks
				<br><br>
		</div>


		<a role="button" class="btn btn-block btn-success" onclick="fetchData();">
			<span id = "fetchDataButton" class="topBannerSubtitle"  style="font-family:Droid Sans Mono;">
				<i class="fa fa-spinner fa-spin fa-lg"></i>&nbsp;Graphing Data
			</span>
		</a>

		<span class="example-val bodyText" id="lower-value"></span>
		<span class="example-val bodyText" id="upper-value"></span>
		<br>
		<div id="slider" style="width:95%;margin:auto;"></div>

		<div style="margin:0 auto;">
			<svg id="chart" width="960" height="500" viewBox="0 0 960 500" preserveAspectRatio="xMidYMid meet" style="padding:10px;"></svg>
		</div>
		<div id="arcDiv"></div>
		<hr>
</div>


<!-- Start Footer -->
    <footer class="footer" >
      <p class="center grey"></span> D3.js | Demo</p>
    </footer>
<!-- End Footer -->

</body>
</html>


<script language="JavaScript" type="text/javascript" src="jquery-3.1.1.min.js"></script>
<script language="JavaScript" type="text/javascript" src="bootstrap-toggle.min.js"></script>
<script language="JavaScript" type="text/javascript" src="d3.v4.min.js"></script>
<script language="JavaScript" type="text/javascript" src="nouislider.js"></script>

<script>

document.addEventListener("DOMContentLoaded", function() 
                                                { 
                                                	createDBSelectionSlider();
                                                	buildGraphOrdinalRanges()
                                                	createGraphZoomSlider();                                                	
                                                });     


var monthNames = ["January", "February", "March", "April", "May", "June","July", "August", "September", "October", "November", "December"];

// var databaseTimespan = {{databaseTimespan|safe}};
var databaseTimespan = [[398, "20170509T1930"], [1838, "20170510T1930"], [3278, "20170511T1930"], [4718, "20170512T1930"], [6158, "20170513T1930"], [7598, "20170514T1930"], [9038, "20170515T1930"], [10478, "20170516T1930"], [11918, "20170517T1930"], [13358, "20170518T1930"], [14798, "20170519T1930"], [16238, "20170520T1930"], [17678, "20170521T1930"], [19118, "20170522T1930"], [20558, "20170523T1930"], [21998, "20170524T1930"], [23438, "20170525T1930"], [24878, "20170526T1930"], [26318, "20170527T1930"], [27758, "20170528T1930"], [29198, "20170529T1930"], [30638, "20170601T1930"], [32078, "20170602T1930"], [33518, "20170603T1930"], [34958, "20170604T1930"], [36398, "20170605T1930"], [37838, "20170606T1930"], [39278, "20170607T1930"], [40718, "20170608T1930"], [42158, "20170609T1930"], [43598, "20170610T1930"], [45038, "20170611T1930"], [46478, "20170612T1930"]];

var dbTimespanRangeUnformatted = [];
var dbTimespanRange = [];
var dbIDRange = [];

// var timeStartDate = '{{timeStartDate|safe}}';
var timeStartDate = '20170601';
timeStartDateFormatted = monthNames[Number(timeStartDate.substr(4, 2))-1]+" "+timeStartDate.substr(6, 2)+", " +timeStartDate.substr(0, 4);

// var timeStopDate = '{{timeStopDate|safe}}';
var timeStopDate = '20170607';
timeStopDateFormatted = monthNames[Number(timeStopDate.substr(4, 2))-1]+" "+timeStopDate.substr(6, 2)+", " +timeStopDate.substr(0, 4);

// var selectedSensorsList = {{selectedSensorsList|safe}};
// var selectedSensorsData = {{selectedSensorsData|safe}};

// DEMO has static data, no REST API calls
var selectedSensorsList = ['id', 'Timestamp', 'AmbientTemperature', 'RelativeHumidity', 'PAR', 'Illuminance', 'Infrared', 'UVA', 'UVB', 
	'Moisture1', 'Moisture2', 'RootZoneTemperature1', 'RootZoneTemperature2', 'CO2', 'PH', 'EC', 'WaterTemperature', 'WaterLevel'];

var selectedSensorsData = [
	[29468, "20170601T0000", "74.7", "60.9", 576, 42986, 1121, 224, 22, "45.9", "58.2", "79.9", "76.6", 1382, "6.1", "522.9", "17.2", "60.0"], 
	[29828, "20170601T0600", "74.7", "59.9", 583, 42186, 1183, 236, 23, "45.7", "55.1", "79.7", "76.4", 1388, "6.1", "522.7", "16.8", "65.0"], 
	[30188, "20170601T1200", "71.1", "56.0", 0, 0, 0, 0, 0, "46.8", "56.1", "76.3", "73.2", 1312, "6.2", "524.8", "17.1", "67.0"], 
	[30548, "20170601T1800", "79.9", "65.8", 0, 0, 0, 0, 0, "48.6", "56.4", "75.2", "72.2", 1312, "6.2", "531.6", "18.8", "67.0"], 
	[30908, "20170602T0000", "76.0", "58.9", 523, 47465, 1019, 203, 20, "49.1", "56.2", "78.8", "75.6", 1282, "6.1", "525.1", "17.4", "69.0"], 
	[31268, "20170602T0600", "74.7", "64.3", 566, 46073, 1101, 220, 22, "47.1", "55.8", "78.2", "75.1", 1332, "6.1", "529.1", "16.4", "78.0"], 
	[31628, "20170602T1200", "78.6", "66.3", 0, 0, 0, 0, 0, "46.9", "57.9", "77.0", "73.9", 1372, "6.1", "531.9", "16.9", "81.0"], 
	[31988, "20170602T1800", "78.6", "58.0", 0, 0, 0, 0, 0, "47.9", "57.6", "76.4", "73.4", 1362, "6.1", "526.9", "16.6", "79.0"], 
	[32348, "20170603T0000", "74.7", "62.9", 549, 47259, 1069, 213, 21, "48.9", "56.6", "79.3", "76.1", 1392, "6.0", "536.9", "16.5", "80.0"], 
	[32708, "20170603T0600", "73.5", "62.9", 587, 46196, 1142, 228, 22, "48.8", "55.7", "77.7", "74.5", 1382, "5.9", "525.8", "16.1", "86.0"], 
	[33068, "20170603T1200", "76.1", "67.7", 0, 0, 0, 0, 0, "46.8", "56.8", "75.0", "72.0", 1382, "5.8", "524.8", "17.1", "89.0"], 
	[33428, "20170603T1800", "78.6", "67.2", 0, 0, 0, 0, 0, "46.9", "56.2", "78.1", "74.9", 1382, "5.7", "520.9", "17.3", "88.0"], 
	[33788, "20170604T0000", "74.7", "63.3", 552, 47622, 1074, 214, 21, "46.4", "55.9", "79.5", "76.2", 1352, "5.6", "525.4", "16.9", "90.0"], 
	[34148, "20170604T0600", "73.5", "61.9", 585, 47275, 1139, 227, 22, "46.9", "56.6", "77.2", "74.0", 1342, "5.5", "530.9", "16.2", "96.0"], 
	[34508, "20170604T1200", "79.9", "64.3", 0, 0, 0, 0, 0, "45.7", "57.8", "77.9", "74.7", 1392, "4.3", "521.7", "16.9", "99.0"], 
	[34868, "20170604T1800", "75.0", "64.3", 604, 7684, 604, 120, 12, "47.8", "56.6", "76.1", "73.0", 1312, "5.5", "517.8", "17.3", "98.0"], 
	[35228, "20170605T0000", "76.1", "60.4", 0, 0, 0, 0, 0, "49.9", "55.3", "76.6", "73.5", 1302, "5.5", "533.9", "17.2", "98.0"], 
	[35588, "20170605T0600", "71.0", "44.3", 570, 46235, 1109, 221, 22, "48.1", "55.8", "78.4", "75.2", 1322, "5.3", "528.1", "15.9", "101.0"], 
	[35948, "20170605T1200", "71.0", "52.1", 584, 46543, 1137, 227, 22, "47.4", "57.3", "81.1", "77.8", 1312, "5.3", "534.4", "16.8", "101.0"], 
	[36308, "20170605T1800", "75.0", "60.9", 61, 6011, 119, 23, 2, "47.4", "56.9", "77.0", "73.9", 1302, "5.4", "520.4", "17.0", "102.0"], 
	[36668, "20170606T0000", "73.5", "65.8", 545, 47264, 1061, 212, 21, "46.2", "62.4", "79.3", "76.1", 1392, "5.7", "527.2", "16.6", "71.0"], 
	[37028, "20170606T0600", "73.5", "60.4", 575, 46615, 1115, 223, 22, "46.8", "62.1", "78.8", "75.6", 1312, "5.6", "516.8", "16.5", "78.0"], 
	[37388, "20170606T1200", "72.4", "60.9", 0, 0, 0, 0, 0, "46.6", "60.8", "76.4", "73.4", 1342, "4.5", "536.6", "17.2", "79.0"], 
	[37748, "20170606T1800", "79.9", "60.9", 0, 0, 0, 0, 0, "46.6", "61.2", "77.2", "74.0", 1382, "5.5", "516.6", "16.9", "76.0"], 
	[38108, "20170607T0000", "72.4", "71.6", 535, 46850, 1042, 208, 20, "48.6", "61.9", "78.4", "75.2", 1342, "5.5", "524.6", "17.9", "76.0"], 
	[38468, "20170607T0600", "72.4", "72.6", 554, 46772, 1078, 215, 21, "47.0", "61.8", "78.2", "75.1", 1322, "5.4", "527.0", "18.4", "83.0"], 
	[38828, "20170607T1200", "72.4", "65.8", 0, 0, 0, 0, 0, "46.6", "61.0", "76.8", "73.7", 1362, "5.4", "519.6", "18.9", "88.0"], 
	[39188, "20170607T1800", "71.1", "65.3", 0, 0, 0, 0, 0, "46.5", "61.8", "78.2", "75.1", 1332, "5.4", "519.5", "18.4", "90.0"]
];

var graphTSV = '';
var ordinalDomain = [];
var ordinalRange = [];
var ordinalUnits = [];
var sliderTimeStampRange = [];
var sliderIDRange = [];
var sliderOffset;
var sliderStartSelection;
var sliderStopSelection;

var excelExportStartID;
var excelExportStopID;

////////////////////////////////////////////////
/////// BEGIN: Creating Selection Slider //////

function createDBSelectionSlider(){
	// build id, Timestamp lists for slider
	for (row of databaseTimespan){

		for (var i=0; i < 2; i++) {
			switch(i){
				case 0:
					dbIDRange.push(row[i]);
					break;
				case 1:
					var timeStampYear = row[1].substr(0, 4);
					var timeStampMonth = Number(row[1].substr(4, 2));
					var timeStampDay = row[1].substr(6, 2);
					dbTimespanRangeUnformatted.push(row[1].substr(0, 8))
					dbTimespanRange.push(monthNames[timeStampMonth-1]+" "+timeStampDay+", " +timeStampYear);
			}
		}
	}

	var linearSlider = document.getElementById('sliderDB');
	noUiSlider.create(sliderDB, {
	    start: [dbTimespanRange.indexOf(timeStartDateFormatted), dbTimespanRange.indexOf(timeStopDateFormatted)],
	    step: 1,
	    connect: true,
	    range: {
	        'min': 0,
	        'max': dbIDRange.length-1
	    }
	});

	var nodesDB = [
	    document.getElementById('lowerDB'), // 0
	    document.getElementById('upperDB')  // 1
	];
	// Display the slider value and how far the handle moved
	// from the left edge of the slider.
	sliderDB.noUiSlider.on('update', function ( values, handle, unencoded, isTap, positions ) {
	    nodesDB[0].innerHTML = dbTimespanRange[parseInt(values[0])];
	    nodesDB[1].innerHTML = dbTimespanRange[parseInt(values[1])];

		timeStartDate = dbTimespanRangeUnformatted[parseInt(values[0])];
		timeStopDate = dbTimespanRangeUnformatted[parseInt(values[1])];

	});

}

/////////////////////////////////////////////
/////// END: Creating Selection Slider //////


////////////////////////////////////////////////
/////// BEGIN: Creating Selection Slider //////

function createGraphZoomSlider(){

	// build id, Timestamp lists for slider
	for (row of selectedSensorsData){
		for (var i=0; i < 2; i++) {
			switch(selectedSensorsList[i]){
				case "id":
					sliderIDRange.push(row[i]);
					break;
				case "Timestamp":
					var timeStampMeredian;
					var timeStampYear = row[1].substr(0, 4);
					var timeStampMonth = Number(row[1].substr(4, 2));
					var timeStampDay = row[1].substr(6, 2);
					var timeStampHour = Number(row[1].substr(9, 2));
					var timeStampMinute = row[1].substr(11, 2);
					switch(timeStampHour){
						case 0:
							timeStampHour = 12; 
							timeStampMeredian = 'AM';
							break;				
						case 1:
						case 2:
						case 3:
						case 4:
						case 5:
						case 6:
						case 7:
						case 8:
						case 9:
						case 10:
						case 11:
							timeStampMeredian = 'AM';
							break;		
						case 12:
							timeStampMeredian = 'PM';
							break;
						default:
							timeStampHour = timeStampHour - 12; 
							timeStampMeredian = 'PM';
					}
					sliderTimeStampRange.push(timeStampHour+":"+timeStampMinute+timeStampMeredian+" "+monthNames[timeStampMonth-1]+" "+timeStampDay+", " +timeStampYear);
			}
		}
	}


	//noUiSlider
	var linearSlider = document.getElementById('slider');
	noUiSlider.create(slider, {
	    start: [0, sliderTimeStampRange.length-1],
	    step: 1,
	    connect: true,
	    range: {
	        'min': 0,
	        'max': sliderTimeStampRange.length-1
	    }
	});
	var nodes = [
	    document.getElementById('lower-value'), // 0
	    document.getElementById('upper-value')  // 1
	];
	// Display the slider value and how far the handle moved
	// from the left edge of the slider.
	var buildGraphTSVFlag;
	slider.noUiSlider.on('update', function ( values, handle, unencoded, isTap, positions ) {
	    nodes[0].innerHTML = 'Zoom Start:&nbsp;' + sliderTimeStampRange[parseInt(values[0])];
	    nodes[1].innerHTML = '&nbsp;&nbsp;End:' + sliderTimeStampRange[parseInt(values[1])];
	    sliderOffset = parseInt(values[0]);
		// document.getElementById("devDisplay4").innerHTML = sliderOffset;
	    sliderStartSelection = sliderIDRange[parseInt(values[0])];
	    sliderStopSelection = sliderIDRange[parseInt(values[1])];
	    if(buildGraphTSVFlag == 1){buildGraphTSV();} // noUiSlider calls this 'on update' function twice when first initializing, wait to build and graph until second pass
	    buildGraphTSVFlag = 1;
	});

}
/////////////////////////////////////////////
/////// END: Creating Selection Slider //////


//////////////////////////////////////////////////
/////// BEGIN: Building Graph Ordinal & TSV //////


// DEMO requires the ordinal ranges to be rebuilt as well as the TSV since there is no backend nor REST API
function rebuildDemo(){
	graphTSV = '';
	ordinalDomain = [];
	ordinalRange = [];
	ordinalUnits = [];
	buildGraphOrdinalRanges();
	buildGraphTSV();

}

function buildGraphOrdinalRanges(){
	// Build Domain and Range Lists, checking if each sensor is in dataset adding to domain, range arrays if true
	// for (var i=0; i < selectedSensorsList.length; i++) {
	// 	if (selectedSensorsList[i] == "AmbientTemperature"){ordinalDomain.push("Ambient Temperature");ordinalRange.push('#1F77B4');ordinalUnits.push('°F');continue;}
	// 	if (selectedSensorsList[i] == "RelativeHumidity"){ordinalDomain.push("Relative Humidity");ordinalRange.push('#33a02c');ordinalUnits.push('%');continue;}
 	//  if (selectedSensorsList[i] == "PAR"){ordinalDomain.push("PAR");ordinalRange.push('#7b7ad7');ordinalUnits.push('PAR');continue;}		
	// 	if (selectedSensorsList[i] == "Illuminance"){ordinalDomain.push("Illuminance");ordinalRange.push('#bcbd22');ordinalUnits.push('lux');continue;}
	// 	if (selectedSensorsList[i] == "Infrared"){ordinalDomain.push("Infrared");ordinalRange.push('#D62728');ordinalUnits.push('uW/cm^2');continue;}
	// 	if (selectedSensorsList[i] == "UVA"){ordinalDomain.push("UVA");ordinalRange.push('#6a3d9a');ordinalUnits.push('uW/cm^2');continue;}
	// 	if (selectedSensorsList[i] == "UVB"){ordinalDomain.push("UVB");ordinalRange.push('#512f75');ordinalUnits.push('uW/cm^2');continue;}
	// 	if (selectedSensorsList[i] == "Moisture1"){ordinalDomain.push("Moisture #1");ordinalRange.push('#17BECF');ordinalUnits.push('%');continue;}
	// 	if (selectedSensorsList[i] == "Moisture2"){ordinalDomain.push("Moisture #2");ordinalRange.push('#1298a5');ordinalUnits.push('%');continue;}
	// 	if (selectedSensorsList[i] == "RootZoneTemperature1"){ordinalDomain.push("R.Z. Temperature #1");ordinalRange.push('#b15928');ordinalUnits.push('°F');continue;}
	// 	if (selectedSensorsList[i] == "RootZoneTemperature2"){ordinalDomain.push("R.Z. Temperature #2");ordinalRange.push('#8d4720');ordinalUnits.push('°F');continue;}
	// 	if (selectedSensorsList[i] == "CO2"){ordinalDomain.push("CO2");ordinalRange.push('#666666');ordinalUnits.push('ppm');continue;}
	// 	if (selectedSensorsList[i] == "PH"){ordinalDomain.push("PH");ordinalRange.push('#D62728');ordinalUnits.push('pH');continue;}
	// 	if (selectedSensorsList[i] == "EC"){ordinalDomain.push("EC");ordinalRange.push('#33a02c');ordinalUnits.push('uS');continue;}
	// 	if (selectedSensorsList[i] == "WaterTemperature"){ordinalDomain.push("Water Temperature");ordinalRange.push('#1F77B4');ordinalUnits.push('°F');continue;}
	// 	if (selectedSensorsList[i] == "WaterLevel"){ordinalDomain.push("Water Level");ordinalRange.push('#17BECF');ordinalUnits.push('%');continue;}
	// }

	// Demo has static data set with all sensors included, add to domain, range arrays only if checkbox is selected
	if (document.getElementById("ambTempCB").checked == true){ordinalDomain.push("Ambient Temperature");ordinalRange.push('#1F77B4');ordinalUnits.push('°F');}
	if (document.getElementById("rhCB").checked == true){ordinalDomain.push("Relative Humidity");ordinalRange.push('#33a02c');ordinalUnits.push('%');}
	if (document.getElementById("parCB").checked == true){ordinalDomain.push("PAR");ordinalRange.push('#7b7ad7');ordinalUnits.push('PAR');}		
	if (document.getElementById("luxCB").checked == true){ordinalDomain.push("Illuminance");ordinalRange.push('#bcbd22');ordinalUnits.push('lux');}
	if (document.getElementById("infraredCB").checked == true){ordinalDomain.push("Infrared");ordinalRange.push('#D62728');ordinalUnits.push('uW/cm^2');}
	if (document.getElementById("uvaCB").checked == true){ordinalDomain.push("UVA");ordinalRange.push('#6a3d9a');ordinalUnits.push('uW/cm^2');}
	if (document.getElementById("uvbCB").checked == true){ordinalDomain.push("UVB");ordinalRange.push('#512f75');ordinalUnits.push('uW/cm^2');}
	if (document.getElementById("m1CB").checked == true){ordinalDomain.push("Moisture #1");ordinalRange.push('#17BECF');ordinalUnits.push('%');}
	if (document.getElementById("m2CB").checked == true){ordinalDomain.push("Moisture #2");ordinalRange.push('#1298a5');ordinalUnits.push('%');}
	if (document.getElementById("rzt1CB").checked == true){ordinalDomain.push("R.Z. Temperature #1");ordinalRange.push('#b15928');ordinalUnits.push('°F');}
	if (document.getElementById("rzt2CB").checked == true){ordinalDomain.push("R.Z. Temperature #2");ordinalRange.push('#8d4720');ordinalUnits.push('°F');}
	if (document.getElementById("co2CB").checked == true){ordinalDomain.push("CO2");ordinalRange.push('#666666');ordinalUnits.push('ppm');}
	if (document.getElementById("phCB").checked == true){ordinalDomain.push("PH");ordinalRange.push('#D62728');ordinalUnits.push('pH');}
	if (document.getElementById("ecCB").checked == true){ordinalDomain.push("EC");ordinalRange.push('#33a02c');ordinalUnits.push('uS');}
	if (document.getElementById("h2oTempCB").checked == true){ordinalDomain.push("Water Temperature");ordinalRange.push('#1F77B4');ordinalUnits.push('°F');}
	if (document.getElementById("h2oLevelCB").checked == true){ordinalDomain.push("Water Level");ordinalRange.push('#17BECF');ordinalUnits.push('%');}
}

function buildGraphTSV(){

	graphTSV = 'Timestamp' + "\t";
	ordinalDomain.forEach(function (value, i, array) {			 // write sensor names to TSV
		if(i === array.length - 1){graphTSV = graphTSV + value;} // no tab on last item
		else{graphTSV = graphTSV + value + "\t";}
	});

	for (row of selectedSensorsData){

		if(row[0] < sliderStartSelection){continue;} // skip rows outside slider selection
		if(row[0] > sliderStopSelection){break;}

		if(row[0] == sliderStartSelection){excelExportStartID = row[0];}
		if(row[0] == sliderStopSelection){excelExportStopID = row[0];}

		graphTSV = graphTSV + '\n';

		// for (var i=0; i < row.length; i++) {
		// 	switch(selectedSensorsList[i]){
		// 		case "id":
		// 			break;
		// 		case "Timestamp":
		// 		case "PAR": 
		// 		case "Illuminance": 
		// 		case "Infrared":
		// 		case "UVA":
		// 		case "UVB":
		// 		case "CO2":
		// 			graphTSV = graphTSV + row[i] + "\t";
		// 			break;
		// 		default:
		// 			graphTSV = graphTSV + parseFloat(row[i]) + "\t";
		// 	}
		// }

		// DEMO has static data set with all sensors included, add to TSV only if checkbox is selected
		for (var i=0; i < row.length; i++) {
			switch(selectedSensorsList[i]){
				case "id":
					break;
				case "Timestamp":
					graphTSV = graphTSV + row[i] + "\t";
					break;
				case "AmbientTemperature":
					if (document.getElementById("ambTempCB").checked == true){graphTSV = graphTSV + parseFloat(row[i]) + "\t";}
					break;
				case "RelativeHumidity":
					if (document.getElementById("rhCB").checked == true){graphTSV = graphTSV + parseFloat(row[i]) + "\t";}
					break;
				case "PAR":
					if (document.getElementById("parCB").checked == true){graphTSV = graphTSV + row[i] + "\t";}
					break;
				case "Illuminance":
					if (document.getElementById("luxCB").checked == true){graphTSV = graphTSV + row[i] + "\t";}
					break;
				case "Infrared":
					if (document.getElementById("infraredCB").checked == true){graphTSV = graphTSV + row[i] + "\t";}
					break;
				case "UVA":
					if (document.getElementById("uvaCB").checked == true){graphTSV = graphTSV + row[i] + "\t";}
					break;
				case "UVB":
					if (document.getElementById("uvbCB").checked == true){graphTSV = graphTSV + row[i] + "\t";}
					break; 
				case "Moisture1":
					if (document.getElementById("m1CB").checked == true){graphTSV = graphTSV + parseFloat(row[i]) + "\t";}
					break;
				case "Moisture2":
					if (document.getElementById("m2CB").checked == true){graphTSV = graphTSV + parseFloat(row[i]) + "\t";}
					break;
				case "RootZoneTemperature1":
					if (document.getElementById("rzt1CB").checked == true){graphTSV = graphTSV + parseFloat(row[i]) + "\t";}
					break;
				case "RootZoneTemperature2":
					if (document.getElementById("rzt2CB").checked == true){graphTSV = graphTSV + parseFloat(row[i]) + "\t";}
					break;
				case "CO2":
					if (document.getElementById("co2CB").checked == true){graphTSV = graphTSV + row[i] + "\t";}
					break;
				case "PH":
					if (document.getElementById("phCB").checked == true){graphTSV = graphTSV + parseFloat(row[i]) + "\t";}
					break;
				case "EC":
					if (document.getElementById("ecCB").checked == true){graphTSV = graphTSV + parseFloat(row[i]) + "\t";}
					break;
				case "WaterTemperature":
					if (document.getElementById("h2oTempCB").checked == true){graphTSV = graphTSV + parseFloat(row[i]) + "\t";}
					break;
				case "WaterLevel":
					if (document.getElementById("h2oLevelCB").checked == true){graphTSV = graphTSV + parseFloat(row[i]) + "\t";}
					break;
				default:
					break;
					
			}
		}
	}
	eraseAndRedrawGraph();
}


////////////////////////////////////////////////
/////// END: Building Graph Ordinal & TSV //////


///////////////////////////////////////////
/////// BEGIN: D3 Graph and Data Arcs //////

// global vars
var targetWidth;
var arcDrawnFlag;
var parseTime = d3.timeParse("%Y%m%dT%H%M"); // define time stamp parser (year month day T(ime) hour minute) e.g. 20170602T0700

function timeStampFormatter(d, _, columns) {
	d.Timestamp = parseTime(d.Timestamp);
	for (var i = 1, n = columns.length, c; i < n; ++i) d[c = columns[i]] = +d[c];
	return d;
}

function eraseAndRedrawGraph(){
	d3.select("g").remove();
	d3.select("div#arcDiv").html("");
	drawGraph();
}

// resize functionality, global for user resize
var chart = $("#chart"),
    aspect = chart.width() / chart.height(),
    container = chart.parent();
$(window).on("resize", function() {
    targetWidth = container.width();
    if(targetWidth > 1000){targetWidth = targetWidth*0.8;}
    chart.attr("width", targetWidth);
    chart.attr("height", Math.round(targetWidth / aspect));
}).trigger("resize");

function drawGraph(){

		var fillColor = document.getElementById("fillColorMenu").value;
		if(fillColor == 'white'){cursorColor = 'black';}
		else{cursorColor = 'white';}
		var cursorEnable = document.getElementById("cursorEnableCheckBox").checked ? 1 : 0;
		var strokeThickness = document.getElementById("strokeThicknessMenu").value;
		var XaxisTickCount = parseInt(document.getElementById("XTickCountMenu").value);
		var YaxisTickCount = parseInt(document.getElementById("YTickCountMenu").value);
		var gridEnable = document.getElementById("gridEnableCheckBox").checked;
		var selectedAxis;
		var ySensors = [];
		var yMinimum = 0;
		var yMaximum = 0;
		var y1Sensors = [];
		var y1Minimum = 0;
		var y1Maximum = 0;
		var leftMargin = 30;
		var rightMargin = 30;	

		// build lists of sensors assigned to y, y1 
		ordinalDomain.forEach(function(value){
			if (value == "Ambient Temperature"){
				if(document.getElementById("ambTempYAxisToggle").checked == true){ySensors.push(value)}
				else{y1Sensors.push(value)}
				return;
			}
			if (value == "Relative Humidity"){
				if(document.getElementById("rhYAxisToggle").checked == true){ySensors.push(value)}
				else{y1Sensors.push(value)}
				return;
			}
			if (value == "PAR"){
				if(document.getElementById("parYAxisToggle").checked == true){ySensors.push(value)}
				else{y1Sensors.push(value)}
				return;
			}
			if (value == "Illuminance"){
				if(document.getElementById("luxYAxisToggle").checked == true){ySensors.push(value)}
				else{y1Sensors.push(value)}
				return;
			}
			if (value == "Infrared"){
				if(document.getElementById("infraredYAxisToggle").checked == true){ySensors.push(value)}
				else{y1Sensors.push(value)}
				return;
			}
			if (value == "UVA"){
				if(document.getElementById("uvaYAxisToggle").checked == true){ySensors.push(value)}
				else{y1Sensors.push(value)}
				return;
			}
			if (value == "UVB"){
				if(document.getElementById("uvbYAxisToggle").checked == true){ySensors.push(value)}
				else{y1Sensors.push(value)}
				return;
			}
			if (value == "Moisture #1"){
				if(document.getElementById("m1YAxisToggle").checked == true){ySensors.push(value)}
				else{y1Sensors.push(value)}
				return;
			}
			if (value == "Moisture #2"){
				if(document.getElementById("m2YAxisToggle").checked == true){ySensors.push(value)}
				else{y1Sensors.push(value)}
				return;
			}
			if (value == "R.Z. Temperature #1"){
				if(document.getElementById("rzt1YAxisToggle").checked == true){ySensors.push(value)}
				else{y1Sensors.push(value)}
				return;
			}
			if (value == "R.Z. Temperature #2"){
				if(document.getElementById("rzt2YAxisToggle").checked == true){ySensors.push(value)}
				else{y1Sensors.push(value)}
				return;
			}
			if (value == "CO2"){
				if(document.getElementById("co2YAxisToggle").checked == true){ySensors.push(value)}
				else{y1Sensors.push(value)}
				return;
			}
			if (value == "PH"){
				if(document.getElementById("phYAxisToggle").checked == true){ySensors.push(value)}
				else{y1Sensors.push(value)}
				return;
			}
			if (value == "EC"){
				if(document.getElementById("ecYAxisToggle").checked == true){ySensors.push(value)}
				else{y1Sensors.push(value)}
				return;
			}
			if (value == "Water Temperature"){
				if(document.getElementById("h2oTempYAxisToggle").checked == true){ySensors.push(value)}
				else{y1Sensors.push(value)}
				return;
			}
			if (value == "Water Level"){
				if(document.getElementById("h2oLevelYAxisToggle").checked == true){ySensors.push(value)}
				else{y1Sensors.push(value)}
				return;
			}
		});

		// determine margins depending on if and which side sensor names will be printed
		if(y1Sensors.length == 0 || gridEnable == false){leftMargin = 30; rightMargin = 100;}
		if(ySensors.length == 0 && gridEnable == true){leftMargin = 100; rightMargin = 30;}	

		// set the dimensions and margins of the graph
		var svg = d3.select("svg"),
				margin = {top: 20, right: rightMargin, bottom: 30, left: leftMargin},
				width = 960 - margin.left - margin.right,
				height = 500 - margin.top - margin.bottom,
				g = svg.append("g")
				.attr('width', '100%')
				.attr('viewBox', '0 0 ' + width + ' ' + height)
				.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

		// set grid/ticks		
		if ( gridEnable == true){
			var XaxisTickLength = -height; // -height for vertical grid
			var YaxisTickTickLength = -width; // -width for horizontal grid
			var Y1axisTickTickLength = width;
		}
		else{
			var XaxisTickLength = 10;
			var YaxisTickTickLength = 10;
			var Y1axisTickTickLength = 10;
		}

		// set the ranges
		var x = d3.scaleTime().range([0, width]),		// create a linear scale for time
			y = d3.scaleLinear().range([height, 0]),	// create a quantitative linear scale
			y1 = d3.scaleLinear().range([height, 0]),	// create a quantitative linear scale
			z = d3.scaleOrdinal().domain(ordinalDomain).range(ordinalRange) // create an ordinal scale for color coding
			zunits = d3.scaleOrdinal().domain(ordinalDomain).range(ordinalUnits);

		// define the line
		var line = d3.line()      									// create a new line generator
						.curve(d3.curveBasis) 						// set the curve interpolator
						.x(function(d) { return x(d.Timestamp); }) 	// set the x accessor
						.y(function(d) { return y(d.dataPoint); });// set the y accessor

		var line1 = d3.line()      									// create a new line generator
						.curve(d3.curveBasis) 						// set the curve interpolator
						.x(function(d) { return x(d.Timestamp); }) 	// set the x accessor
						.y(function(d) { return y1(d.dataPoint); });// set the y accessor


		data = d3.tsvParse(graphTSV, timeStampFormatter); // tsv to d3 object
		//document.getElementById("devDisplay4").innerHTML = JSON.stringify(data);


		// prepare data for graphing
		var parsedTSV = data.columns.slice(1).map(function(id) {

			if(ySensors.indexOf(id) >= 0){selectedAxis = 'y'}	// determine which y-axis the sensor is assigned to
			else{selectedAxis = 'y1'}

			return {
				id: id,
				sensorXY: data.map(function(d) {

					if(selectedAxis == 'y'){	// determine axis maximum and minimum
						if(yMinimum > d[id]){yMinimum = d[id];}
						if(yMaximum < d[id]){yMaximum = d[id];}
					}
					if(selectedAxis == 'y1'){
						if(y1Minimum > d[id]){y1Minimum = d[id];}
						if(y1Maximum < d[id]){y1Maximum = d[id];}
					}

					return {
					Timestamp: d.Timestamp, 
					dataPoint: d[id]
					};
				})
			};
		});

		// X-Range 
		x.domain(d3.extent(data, function(d) { return d.Timestamp; }));	// d3.extent - compute the minimum and maximum (x-axis time stamps)
		// Y-Range(s)
		yMaximum++;	// add padding on the top end
		y1Maximum++;
		y.domain([yMinimum, yMaximum]);  // set y-range max/min
		y1.domain([y1Minimum, y1Maximum]);  // set y1-range max/min
		// Z-Range (color coding)
		z.domain(d3.keys(data[0]).filter(function(key) { return key !== "Timestamp"; }));

		// append rectangle for tracking x-axis on mouse move
		g.append("rect")
			.data(parsedTSV)
			.attr("width", width)
			.attr("height", height)
			.attr("fill", fillColor)
			.on("mousemove", function(d) {
											var mouse = d3.mouse(this);
											d3.select("#mouse-line")
												.attr("d", function(){
													var d = "M" + mouse[0] + "," + height;
													d += " " + mouse[0] + "," + 0;
													return d;
												});

											var xdataPoint = Math.round(mouse[0]/(width/d.sensorXY.length));
											if(xdataPoint == d.sensorXY.length){xdataPoint -= 1;}	// index as length of sensorXY list is undefined as counting starts from zero
											d3.selectAll("#arcTextValue")
												//.text(function(d) { return (d.sensorXY[xdataPoint+sliderOffset].dataPoint); });
												.text(function(d) { return (d.sensorXY[xdataPoint].dataPoint); });	// offset not needed in demo given static dataset contains all points i.e. no backend filtering
										});

		// draw x-axis
		g.append("g")
			.attr("transform", "translate(0," + height + ")")
			.attr("stroke-width", .5) // thin grid line
			.call(d3.axisBottom(x)
				.ticks(XaxisTickCount)
				.tickSize(XaxisTickLength)
				.tickPadding(6));

		// draw y-axis
		if(ySensors.length > 0){	// draw axis only if sensors are assigned to it
			g.append("g")
				.attr("stroke-width", .5) // thin grid line
				.call(d3.axisLeft(y)
					.ticks(YaxisTickCount)
					.tickSize(YaxisTickTickLength)
					.tickPadding(6));
		}

		// draw y1-axis
		if(y1Sensors.length > 0){
			g.append("g")
				.attr("stroke-width", .5)
				.call(d3.axisRight(y1)
					.ticks(YaxisTickCount)
					.tickSize(Y1axisTickTickLength)
					.tickPadding(6));
		}

		// select sensor data  
		var sensor = g.selectAll().data(parsedTSV).enter().append("g");

		// draw sensor data paths
		sensor.append("path")
			.attr('fill', 'none')
			.attr('stroke-width', strokeThickness)
			.attr("d", function(d) { 
										if(ySensors.indexOf(d.id) >= 0){return line(d.sensorXY);}
										else{return line1(d.sensorXY);}
									})
			.style("stroke", function(d) { return z(d.id); });


		
		var drawnLocs = [];
		var yPLoc;
		// draw sensor names at last datapoint
		if(y1Sensors.length == 0 || gridEnable == false){
			sensor.append("text")
				.datum(function(d) { return {id: d.id, value: d.sensorXY[d.sensorXY.length - 1]}; })
				.attr("transform", function(d) { 	
													yPLoc = 0;
													if(ySensors.indexOf(d.id) >= 0){yPLoc = Math.round(100*(d.value.dataPoint)/yMaximum);} // scale to y
													else{yPLoc = Math.round(100*(d.value.dataPoint)/y1Maximum);} // else scale to y1
														
													for (i = 0; i < drawnLocs.length; i++) { 
														if((yPLoc <= (drawnLocs[i]+2)) && (yPLoc >= (drawnLocs[i]-2))){ // if +/- 2% of previously written name do not display 
															return "translate(-1000)"; // translate x-axis -1000 units i.e. off page
														}
													}
													drawnLocs.push(yPLoc);	// keep track of all drawn locations
														
													if(ySensors.indexOf(d.id) >= 0){return "translate(" + x(d.value.Timestamp) + "," + y(d.value.dataPoint) + ")"; }
													else{return "translate(" + x(d.value.Timestamp) + "," + y1(d.value.dataPoint) + ")"; }
												})
				.attr("x", 6)
				.attr("dy", "0.35em")
				.attr("font-size","10px")
				.attr("font-family","monospace")
				.attr("font-weight","bold")
				.style("fill", function(d) { return z(d.id); })
				.text(function(d) { return d.id; });
		}


		// draw sensor names at first datapoint
		if(ySensors.length == 0 && gridEnable == true){
			sensor.append("text")
				.datum(function(d) { return {id: d.id, value: d.sensorXY[0]}; })
				.attr("transform", function(d) { 
													yPLoc = 0;
													if(ySensors.indexOf(d.id) >= 0){yPLoc = Math.round(100*(d.value.dataPoint)/yMaximum);} // scale to y
													else{yPLoc = Math.round(100*(d.value.dataPoint)/y1Maximum);} // else scale to y1
														
													for (i = 0; i < drawnLocs.length; i++) { 
														if((yPLoc <= (drawnLocs[i]+2)) && (yPLoc >= (drawnLocs[i]-2))){ // if +/- 2% of previously written name do not display 
															return "translate(-1000)"; // translate x-axis -1000 units i.e. off page
														}
													}
													drawnLocs.push(yPLoc);	// keep track of all drawn locations
														
													if(ySensors.indexOf(d.id) >= 0){return "translate(" + x(d.value.Timestamp) + "," + y(d.value.dataPoint) + ")"; }
													else{return "translate(" + x(d.value.Timestamp) + "," + y1(d.value.dataPoint) + ")"; }
												})
				.attr("x", function(d) { 
											if(d.id == "Ambient Temperature"){return -120;}
											if(d.id == "Relative Humidity"){return -110;}
											if(d.id == "PAR"){return -25;}
											if(d.id == "Illuminance"){return -72;}
											if(d.id == "Infrared"){return -55;}
											if(d.id == "UVA"){return -25;}
											if(d.id == "UVB"){return -25;}
											if(d.id == "Moisture #1"){return -72;}
											if(d.id == "Moisture #2"){return -72;}
											if(d.id == "R.Z. Temperature #1"){return -120;}
											if(d.id == "R.Z. Temperature #2"){return -120;}
											if(d.id == "CO2"){return -25;}
											if(d.id == "PH"){return -20;}
											if(d.id == "EC"){return -20;}
											if(d.id == "Water Temperature"){return -110;}
											if(d.id == "Water Level"){return -72;}
										})
				.attr("dy", ".35em")
				.attr("font-size","10px")
				.attr("font-family","monospace")
				.attr("font-weight","bold")
				.style("fill", function(d) { return z(d.id); })
				.text(function(d) { return d.id; });
		}

		// vertical line to follow mouse
		g.append("path")
			.attr("id", "mouse-line")
			.style("stroke", cursorColor)
			.style("stroke-width", "1px")
			.style("opacity", cursorEnable);

		// ARC
		if(arcDrawnFlag == null){ // only draw arcs on first pass

				var outerArcPlusPadding = 40,
				  innerArcRadius = 25,
				  outerArcRadius = 30,
				  textOutsideArcSize = ".9em";
				  textInsideArcSize = ".7em";

				var tau = 2 * Math.PI,
				  arc = d3.arc()
				    .innerRadius(innerArcRadius)
				    .outerRadius(outerArcRadius)
				    .startAngle(0);

				var svgArc = d3.select("div#arcDiv").selectAll("#arcDiv")
						.data(parsedTSV)
						.enter().append("svg")
						.attr("width", outerArcPlusPadding * 2)
						.attr("height", outerArcPlusPadding * 2),
					gArc = svgArc.append("g").attr("transform", "translate(" + outerArcPlusPadding + "," + outerArcPlusPadding + ")");

				// Add the background arc, from 0 to 100% (tau).
				gArc.append("path")
					.attr("id", "arcText") //A unique ID to reference later
				    .datum({endAngle: tau})
				    .style("fill", "#efefef")
				    .attr("d", arc);

				// Add the foreground arc
				gArc.append("path")
				    .datum({endAngle: 0 * tau}) // 0%
					.style("fill", function(d, i) { return z(parsedTSV[i].id); })
				  	.transition()
				    .duration(0)
				    .attrTween("d", arcTween());	    

				//Create an SVG text element and append a textPath element
				gArc.append("text")
					.append("textPath")				//append a textPath to the text element
					.attr("xlink:href", "#arcText") //place the ID of the path here
				    .attr("font-size",textInsideArcSize)
				    .attr("font-family","monospace")   
				    .attr("font-weight","bold")	
					.style("fill", function(d) { return z(d.id); })
					.text(function(d) { return d.id; });

				gArc.append("text")
					.attr("id", "arcTextValue")
					.attr("xlink:href", "#arcText") //place the ID of the path here
					.attr("font-size",textOutsideArcSize)
					.attr("font-family","monospace")  
					.attr("font-weight","bold")
					.style("text-anchor","middle")
					.style("fill", function(d) { return z(d.id); })	

				gArc.append("text")
					.attr("xlink:href", "#arcText") //place the ID of the path here
					.attr("font-size",textInsideArcSize)
					.attr("font-family","monospace")  
					.attr("font-weight","bold")
					.attr("transform", "translate(0,12)")
					.style("text-anchor","middle")
					.style("fill", function(d) { return z(d.id); })	
					.text(function(d) { return zunits(d.id); });

					function arcTween() {
					  return function(d, i) {
					    var interpolate = d3.interpolate(d.endAngle, (80/100)*tau);
					    return function(t) {
					      d.endAngle = interpolate(t);
					      return arc(d);
					    };
					  };
					}

		// set flag do not draw again
		//arcDrawnFlag = 1;
		document.getElementById("fetchDataButton").innerHTML = "<i class='fa fa-leaf fa-lg'></i>&nbsp;Request Data";
		}
// END: function drawGraph()
}

///////////////////////////////////////////
/////// END: D3 Graph and Data Arcs //////


///////////////////////////////////
/////// START: Graph Buttons //////

function yAxisToggleShowHide(){
	if($(yAxisToggleDisplay).is(":visible")){$('#yAxisToggleDisplay').hide()}
	else{$('#graphSettingDisplay').hide();$('#yAxisToggleDisplay').show()}
}

function graphSettingShowHide(){
	if($(graphSettingDisplay).is(":visible")){$('#graphSettingDisplay').hide()}
	else{$('#yAxisToggleDisplay').hide();$('#graphSettingDisplay').show()}
}

function plus(){
	if(targetWidth >= container.width()*0.95){return;}
	targetWidth = targetWidth*1.1;			
	chart.attr("width", targetWidth);
	chart.attr("height", Math.round(targetWidth / aspect));
}

function minus(){
		if(targetWidth < 300){return;}
		targetWidth = targetWidth*0.90;			
		chart.attr("width", targetWidth);
		chart.attr("height", Math.round(targetWidth / aspect));
}

/////////////////////////////////
/////// END: Graph Buttons //////


///////////////////////////////
/////// START: fetchData //////

function fetchData(){

	document.getElementById("fetchDataButton").innerHTML = "<i class='fa fa-spinner fa-spin fa-lg'></i>&nbsp;<s>&nbsp;Retrieving Data&nbsp;</s>&nbsp;Not Supported In Demo";

    var apiEndpoint = '/sensors/changeGraphSettings?format=json&timeStartDate='+timeStartDate	// Build API Endpoint
    				+'&timeStopDate='+timeStopDate
    				+'&timeInterval='+(document.getElementById("timeIntervalMenu").value)	
                    +'&ambTempCB='+(document.getElementById("ambTempCB").checked ? 'True' : 'False')
                    +'&rhCB='+(document.getElementById("rhCB").checked ? 'True' : 'False')
                    +'&parCB='+(document.getElementById("parCB").checked ? 'True' : 'False')
                    +'&luxCB='+(document.getElementById("luxCB").checked ? 'True' : 'False')
                    +'&infraredCB='+(document.getElementById("infraredCB").checked ? 'True' : 'False')
                    +'&uvaCB='+(document.getElementById("uvaCB").checked ? 'True' : 'False')
                    +'&uvbCB='+(document.getElementById("uvbCB").checked ? 'True' : 'False')
                    +'&m1CB='+(document.getElementById("m1CB").checked ? 'True' : 'False')
                    +'&m2CB='+(document.getElementById("m2CB").checked ? 'True' : 'False')
                    +'&rzt1CB='+(document.getElementById("rzt1CB").checked ? 'True' : 'False')
                    +'&rzt2CB='+(document.getElementById("rzt2CB").checked ? 'True' : 'False')
                    +'&co2CB='+(document.getElementById("co2CB").checked ? 'True' : 'False')
                    +'&phCB='+(document.getElementById("phCB").checked ? 'True' : 'False')
                    +'&ecCB='+(document.getElementById("ecCB").checked ? 'True' : 'False')
                    +'&h2oTempCB='+(document.getElementById("h2oTempCB").checked ? 'True' : 'False')
                    +'&h2oLevelCB='+(document.getElementById("h2oLevelCB").checked ? 'True' : 'False')

                    +'&ambTempYAxisToggle='+(document.getElementById("ambTempYAxisToggle").checked ? 'True' : 'False')
                    +'&rhYAxisToggle='+(document.getElementById("rhYAxisToggle").checked ? 'True' : 'False')
                    +'&parYAxisToggle='+(document.getElementById("parYAxisToggle").checked ? 'True' : 'False')
                    +'&luxYAxisToggle='+(document.getElementById("luxYAxisToggle").checked ? 'True' : 'False')
                    +'&infraredYAxisToggle='+(document.getElementById("infraredYAxisToggle").checked ? 'True' : 'False')
                    +'&uvaYAxisToggle='+(document.getElementById("uvaYAxisToggle").checked ? 'True' : 'False')
                    +'&uvbYAxisToggle='+(document.getElementById("uvbYAxisToggle").checked ? 'True' : 'False')
                    +'&m1YAxisToggle='+(document.getElementById("m1YAxisToggle").checked ? 'True' : 'False')
                    +'&m2YAxisToggle='+(document.getElementById("m2YAxisToggle").checked ? 'True' : 'False')
                    +'&rzt1YAxisToggle='+(document.getElementById("rzt1YAxisToggle").checked ? 'True' : 'False')
                    +'&rzt2YAxisToggle='+(document.getElementById("rzt2YAxisToggle").checked ? 'True' : 'False')
                    +'&co2YAxisToggle='+(document.getElementById("co2YAxisToggle").checked ? 'True' : 'False')
                    +'&phYAxisToggle='+(document.getElementById("phYAxisToggle").checked ? 'True' : 'False')
                    +'&ecYAxisToggle='+(document.getElementById("ecYAxisToggle").checked ? 'True' : 'False')
                    +'&h2oTempYAxisToggle='+(document.getElementById("h2oTempYAxisToggle").checked ? 'True' : 'False')
                    +'&h2oLevelYAxisToggle='+(document.getElementById("h2oLevelYAxisToggle").checked ? 'True' : 'False')

                    +'&fillColor='+(document.getElementById("fillColorMenu").value)
                    +'&strokeThickness='+(document.getElementById("strokeThicknessMenu").value)
                    +'&gridEnable='+(document.getElementById("gridEnableCheckBox").checked ? 'True' : 'False')
                    +'&cursorEnable='+(document.getElementById("cursorEnableCheckBox").checked ? 'True' : 'False')
                    +'&XTickCount='+(document.getElementById("XTickCountMenu").value)
                    +'&YTickCount='+(document.getElementById("YTickCountMenu").value);

     // $.ajax({
     //            type: 'POST',
     //            url: apiEndpoint,
     //            contentType: 'application/json',
     //            dataType: 'json',
     //            success: function(data) {
					// 						location.reload();
     //                                    },
     //        });
}

/////////////////////////////
/////// END: fetchData //////


// Request Excel Export

function requestExcelExport() { 

	document.getElementById("downloadExcelFileButton").style.display = 'none';
	document.getElementById("excelExportIcon").className = 'fa fa-spinner fa-spin fa-lg';

	$.ajax({
				type: 'POST',
				url: '/sensors/excelExport?selectedSensorsList='+selectedSensorsList+'&excelExportStartID='+excelExportStartID+'&excelExportStopID='+excelExportStopID+'&timeInterval='+document.getElementById("timeIntervalMenu").value,
				contentType: 'application/json',
				dataType: 'json',
				success: function(data) {
											actionPath = '/sensors/excelDownload?downloadFileName='+ data;
											document.getElementById("pathToExcelDownload").action = actionPath;

											document.getElementById("excelExportIcon").className = 'fa fa-file-excel-o fa-lg';
											document.getElementById("downloadExcelFileButton").style.display = 'inline-block';
			},
	});		

}

</script>